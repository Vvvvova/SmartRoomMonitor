# ğŸ  SmartRoomMonitor (ACM-1)

![Maintenance](https://img.shields.io/badge/Maintenance-No-red.svg)
[![Platform](https://img.shields.io/badge/Platform-ESP32-blue.svg)](https://www.espressif.com/en/products/socs/esp32)
[![Framework](https://img.shields.io/badge/Framework-Arduino-00979D.svg)](https://www.arduino.cc/)

[![Framework](https://img.shields.io/badge/Framework-Arduino-00979D.svg)](https://www.arduino.cc/)
[![PlatformIO](https://img.shields.io/badge/Build%20System-PlatformIO-orange.svg)](https://platformio.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

---

## âœ¨ Features

- ğŸ“Š **Real-time monitoring** â€” Temperature, humidity, and dew point displayed on OLED and web dashboard.
- ğŸªŸ **Smart window detection** â€” Automatically detects when you open/close windows using physics-based algorithms (Absolute Humidity).
- ğŸ§  **Physics Engine** â€” Uses Absolute Humidity (g/mÂ³) rather than just Relative Humidity (%) ensuring accurate advice regardless of temperature changes.
- ğŸ„ **Mold risk alerts** â€” Proactively warns when the dew point margin becomes dangerously low (< 3Â°C).
- ğŸ¤– **Telegram bot** â€” Receive notifications, check status, and control settings remotely.
- ğŸŒ **Web dashboard** â€” Beautiful dark-themed interface with live Chart.js graphs and history data.
- â›… **Weather API** â€” Integrates outdoor weather data (Open-Meteo) for context-aware ventilation advice.
- ğŸŒ™ **Night mode** â€” OLED display turns off automatically at night (configurable hours).

---

## ğŸ“¸ Screenshots

| Web Dashboard | OLED Display | Telegram Bot |
|:-------------:|:------------:|:------------:|
| ![Dashboard](docs/images/dashboard.png) | ![OLED](docs/images/oled.png) | ![Telegram](docs/images/telegram.png) |

> *Note:* The web dashboard screenshot above was translated to English for demonstration purposes. The actual device interface and Telegram bot use **Russian language**, as this system was built for personal home use.

> *Privacy Note:* The IP address shown on the OLED screen (e.g., 192.168.x.x) is a local network address and is not accessible from the outside internet.

---

## ğŸ”§ Hardware

| Component | Model | Connection |
|-----------|-------|------------|
| Microcontroller | ESP32 DevKit V1 | â€” |
| Sensor | DHT22 (AM2302) | GPIO 14 |
| Display | 0.96" OLED SSD1306 (128Ã—64) | I2C (SDA: 21, SCL: 22) |

### âš ï¸ Calibration Note

This project is designed as an "All-In-One" box solution. Due to the heat generated by the ESP32 chip inside the enclosure, the DHT22 readings are affected. 

**Software calibration is applied in `SensorManager.cpp`:**
- **Temperature:** `-2.0Â°C` offset (compensates for self-heating).
- **Humidity:** `+10.9%` offset (linear correction).

> *If you build this with the sensor placed outside the case, you should reset these offsets in `Settings.h` to 0.*

---

## ğŸ› ï¸ Installation

### Prerequisites
- [PlatformIO](https://platformio.org/install) (VS Code extension recommended)
- ESP32 Development Board

### Setup Steps

1. **Clone the repository**
   ```bash
   git clone https://github.com/YOUR_USERNAME/SmartRoomMonitor.git
   cd SmartRoomMonitor
   ```

2. **Configure Settings**
   The project requires a `Settings.h` file which contains your private credentials (WiFi, Tokens). 
   Use the provided template:
   
   ```bash
   # Copy the template
   cp include/SettingsTemplate.h include/Settings.h
   ```

3. **Edit `include/Settings.h`**
   Open the file and fill in your details:
   - `WIFI_SSID` / `WIFI_PASS`: Your network credentials.
   - `BOT_TOKEN`: Telegram bot token from @BotFather.
   - `OWNER_CHAT_ID`: Your Telegram User ID (get it from @userinfobot).
   - `WEATHER_API_URL`: Update coordinates for your city (default: Weiden, Germany).

4. **Build & Upload**
   Connect your ESP32 and run:
   ```bash
   pio run --target upload
   ```

---

## ğŸ§  How It Works: The Smart State Machine

The core logic uses a 4-state machine to manage ventilation cycles effectively:

```mermaid
graph TD
    A[STABLE] -- "Temp Drop > 0.5Â°C\nOR Hum Drop > 3%" --> B[VENTILATING]
    B -- "Target Reached\nAbsHum <= Goal" --> C[TARGET_MET]
    B -- "Efficiency Drop\nAvg Slope > -0.15" --> D[INEFFICIENT]
    C -- "Window Closed\n(Rebound Detected)" --> A
    D -- "Window Closed\n(Rebound Detected)" --> A
```

1. **STABLE**: Monitors climate every 2 minutes. Saves energy.
2. **VENTILATING**: High-frequency polling (6s). Tracks moisture removal.
3. **TARGET_MET**: Signal to close window (Goal reached).
4. **INEFFICIENT**: Signal to close window (Ventilation no longer effective, e.g., raining outside).

---

## ğŸ“ Project Structure

```
SmartRoomMonitor/
â”œâ”€â”€ docs/                    # Documentation assets & images
â”œâ”€â”€ include/                 # Header files
â”‚   â”œâ”€â”€ ClimateMath.h        # Physics calculations (Dew Point, Abs Humidity)
â”‚   â”œâ”€â”€ DisplayManager.h     # OLED UI interface
â”‚   â”œâ”€â”€ SensorManager.h      # Core logic & State Machine
â”‚   â”œâ”€â”€ SettingsTemplate.h   # ğŸ“ Template for your credentials (WiFi, Keys)
â”‚   â”œâ”€â”€ TelegramManager.h    # Bot communication
â”‚   â”œâ”€â”€ WeatherManager.h     # Open-Meteo API integration
â”‚   â””â”€â”€ WebManager.h         # Async Web Server & JSON API
â”œâ”€â”€ src/                     # Source Code (.cpp implementation)
â”‚   â”œâ”€â”€ main.cpp             # Setup & Loop orchestration
â”‚   â””â”€â”€ ...                  # Implementation of managers
â”œâ”€â”€ documentation.md         # Full Technical Documentation (English)
â”œâ”€â”€ documentation_ru.md      # Full Technical Documentation (Russian)
â”œâ”€â”€ platformio.ini           # Project build configuration
â””â”€â”€ README.md                # This file
```

---

## ğŸ“– Documentation

For a deep dive into the code, thread safety, and logic explanation:

- ğŸ‡¬ğŸ‡§ **[English Documentation](documentation.md)**
- ğŸ‡·ğŸ‡º **[Russian Documentation (Original)](documentation_ru.md)**

---

## ğŸ“¡ API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/` | GET | Main Dashboard (HTML) |
| `/api/status` | GET | Current live readings & advice (JSON) |
| `/api/history` | GET | Full history buffer (Chunked JSON Stream) |

---

## ğŸ“¦ Dependencies

- **Adafruit SSD1306 & GFX** (Display)
- **DHT Sensor Library** (Sensors)
- **ArduinoJson** (Data serialization)
- **ESPAsyncWebServer** & **AsyncTCP** (Web Interface)
- **UniversalTelegramBot** (Notifications)

---

## ğŸ“„ License

This project is open source and available under the [MIT License](LICENSE).
